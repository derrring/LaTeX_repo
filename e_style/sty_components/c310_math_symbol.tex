
%----------------------------------------------------------------------
%% General
%----------------------------------------------------------------------

% Math mode set \mathnormal as default, we don't abbreviate \mathsf
% (sans-serif) and \mathtt.
% Main goals of general part are:
% 1. to simplify the usage of \mathbb, \mathscr, \mathcal, \mathfrak,
% \bm(= \mathbf)
% 2. to define  \mathsfit and \mathbmsfit

%Note: \bm provided by \usepackage{bm} is replaced by \symbsfit and \mathbmsfit
%Note: c.f. package {unicode-math}

%----------------------------------------------------------------------
%% Delimiters
%----------------------------------------------------------------------
% offered by \usepackage{mathtools}
% Improved delimiter definitions using mathtools

% Basic paired delimiters - these auto-scale with * version
\DeclarePairedDelimiter{\parens}{(}{)}
\DeclarePairedDelimiter{\bracks}{[}{]}
\DeclarePairedDelimiter{\abs}{\lvert}{\rvert}
\DeclarePairedDelimiter{\norm}{\lVert}{\rVert}
\DeclarePairedDelimiter{\ceil}{\lceil}{\rceil}
\DeclarePairedDelimiter{\floor}{\lfloor}{\rfloor}

% Angle brackets for inner products
\DeclarePairedDelimiter{\innerp}{\langle}{\rangle}

% Quantum mechanics notation
\DeclarePairedDelimiter{\ket}{\lvert}{\rangle}
\DeclarePairedDelimiter{\bra}{\langle}{\rvert}

% Braket with middle separator
\DeclarePairedDelimiterX{\braket}[2]{\langle}{\rangle}{#1 \delimsize\vert #2}
\DeclarePairedDelimiterX\braketop[3]{\langle}{\rangle}{
#1\,\delimsize\vert\,\mathopen{}#2\,\delimsize\vert\,\mathopen{}#3}
\DeclareDocumentCommand{\given}{}{%
    \mathrel{\vert}%
}
% Set notation with conditional (\ensemble)
\newcommand\SetSymbol[1][]{%
    \nonscript\: #1 \vert
    \allowbreak
    \nonscript\:
    \mathopen{}
}
\DeclarePairedDelimiterX\ensemble[1]\{\}{%
    \renewcommand\given{\SetSymbol[\delimsize]}
    #1
}

% Better approach for parts:
\newcommand{\pospart}[1]{\bracks*{#1}_{+}}
\newcommand{\negpart}[1]{\bracks*{#1}_{-}}

% Triple norm with better spacing
\DeclarePairedDelimiterX{\trinorm}[1]{\lvert\kern-0.25ex\lvert\kern-0.25ex\lvert}{\rvert\kern-0.25ex\rvert\kern-0.25ex\rvert}{#1}

% Usage examples:
% \parens{x}     - fixed size parentheses
% \parens*{x}    - auto-scaling parentheses
% \parens[\big]{x} - specific size

% \abs{x}        - fixed size absolute value
% \abs*{\frac{a}{b}} - auto-scaling

% \braket{x}{y}  - braket notation
% \braket*{\frac{a}{b}}{\frac{c}{d}} - auto-scaling braket

% \set{x \given x > 0} - set with condition
% \set*{x \given x > 0} - auto-scaling set

% For line breaks in math mode (your \middlebreak issue):
% Use \allowbreak or the breqn package for automatic breaking
% Or use align/split environments for manual breaking

% Sets
\newcommand{\mbbA}{\mathbb{A}}
\newcommand{\mbbB}{\mathbb{B}}
\newcommand{\mbbC}{\mathbb{C}}
\newcommand{\mbbD}{\mathbb{D}}
\newcommand{\mbbE}{\mathbb{E}}
\newcommand{\mbbF}{\mathbb{F}}
\newcommand{\mbbG}{\mathbb{G}}
\newcommand{\mbbH}{\mathbb{H}}
\newcommand{\mbbI}{\mathbb{I}}
\newcommand{\mbbJ}{\mathbb{J}}
\newcommand{\mbbK}{\mathbb{K}}
\newcommand{\mbbL}{\mathbb{L}}
\newcommand{\mbbM}{\mathbb{M}}
\newcommand{\mbbN}{\mathbb{N}}
\newcommand{\mbbO}{\mathbb{O}}
\newcommand{\mbbP}{\mathbb{P}}
\newcommand{\mbbQ}{\mathbb{Q}}
\newcommand{\mbbR}{\mathbb{R}}
\newcommand{\mbbS}{\mathbb{S}}
\newcommand{\mbbT}{\mathbb{T}}
\newcommand{\mbbU}{\mathbb{U}}
\newcommand{\mbbV}{\mathbb{V}}
\newcommand{\mbbW}{\mathbb{W}}
\newcommand{\mbbX}{\mathbb{X}}
\newcommand{\mbbY}{\mathbb{Y}}
\newcommand{\mbbZ}{\mathbb{Z}}

\newcommand{\mbbone}{\mathbb{1}}

% Bold for \mathbf
\newcommand{\mbfzero}{\mathbf{0}}
\newcommand{\mbfone}{\mathbf{1}}

\newcommand{\mbfa}{\mathbf{a}}
\newcommand{\mbfb}{\mathbf{b}}
\newcommand{\mbfc}{\mathbf{c}}
\newcommand{\mbfd}{\mathbf{d}}
\newcommand{\mbfe}{\mathbf{e}}
\newcommand{\mbff}{\mathbf{f}}
\newcommand{\mbfg}{\mathbf{g}}
\newcommand{\mbfh}{\mathbf{h}}
\newcommand{\mbfi}{\mathbf{i}}
\newcommand{\mbfj}{\mathbf{j}}
\newcommand{\mbfk}{\mathbf{k}}
\newcommand{\mbfl}{\mathbf{l}}
\newcommand{\mbfm}{\mathbf{m}}
\newcommand{\mbfn}{\mathbf{n}}
\newcommand{\mbfo}{\mathbf{o}}
\newcommand{\mbfp}{\mathbf{p}}
\newcommand{\mbfq}{\mathbf{q}}
\newcommand{\mbfr}{\mathbf{r}}
\newcommand{\mbfs}{\mathbf{s}}
\newcommand{\mbft}{\mathbf{t}}
\newcommand{\mbfu}{\mathbf{u}}
\newcommand{\mbfv}{\mathbf{v}}
\newcommand{\mbfw}{\mathbf{w}}
\newcommand{\mbfx}{\mathbf{x}}
\newcommand{\mbfy}{\mathbf{y}}
\newcommand{\mbfz}{\mathbf{z}}

\newcommand{\mbfA}{\mathbf{A}}
\newcommand{\mbfB}{\mathbf{B}}
\newcommand{\mbfC}{\mathbf{C}}
\newcommand{\mbfD}{\mathbf{D}}
\newcommand{\mbfE}{\mathbf{E}}
\newcommand{\mbfF}{\mathbf{F}}
\newcommand{\mbfG}{\mathbf{G}}
\newcommand{\mbfH}{\mathbf{H}}
\newcommand{\mbfI}{\mathbf{I}}
\newcommand{\mbfJ}{\mathbf{J}}
\newcommand{\mbfK}{\mathbf{K}}
\newcommand{\mbfL}{\mathbf{L}}
\newcommand{\mbfM}{\mathbf{M}}
\newcommand{\mbfN}{\mathbf{N}}
\newcommand{\mbfO}{\mathbf{O}}
\newcommand{\mbfP}{\mathbf{P}}
\newcommand{\mbfQ}{\mathbf{Q}}
\newcommand{\mbfR}{\mathbf{R}}
\newcommand{\mbfS}{\mathbf{S}}
\newcommand{\mbfT}{\mathbf{T}}
\newcommand{\mbfU}{\mathbf{U}}
\newcommand{\mbfV}{\mathbf{V}}
\newcommand{\mbfW}{\mathbf{W}}
\newcommand{\mbfX}{\mathbf{X}}
\newcommand{\mbfY}{\mathbf{Y}}
\newcommand{\mbfZ}{\mathbf{Z}}

\newcommand{\mbfalpha}{\mathbf{\alpha}}
\newcommand{\mbfbeta}{\mathbf{\beta}}
\newcommand{\mbfgamma}{\mathbf{\gamma}}
\newcommand{\mbfdelta}{\mathbf{\delta}}
\newcommand{\mbfepsilon}{\mathbf{\epsilon}}
\newcommand{\mbfzeta}{\mathbf{\zeta}}
\newcommand{\mbfeta}{\mathbf{\eta}}
\newcommand{\mbftheta}{\mathbf{\theta}}
\newcommand{\mbfiota}{\mathbf{\iota}}
\newcommand{\mbfkappa}{\mathbf{\kappa}}
\newcommand{\mbflambda}{\mathbf{\lambda}}
\newcommand{\mbfmu}{\mathbf{\mu}}
\newcommand{\mbfnu}{\mathbf{\nu}}
\newcommand{\mbfxi}{\mathbf{\xi}}
\newcommand{\mbfpi}{\mathbf{\pi}}
\newcommand{\mbfrho}{\mathbf{\rho}}
\newcommand{\mbfsigma}{\mathbf{\sigma}}
\newcommand{\mbftau}{\mathbf{\tau}}
\newcommand{\mbfupsilon}{\mathbf{\upsilon}}
\newcommand{\mbfphi}{\mathbf{\phi}}
\newcommand{\mbfchi}{\mathbf{\chi}}
\newcommand{\mbfpsi}{\mathbf{\psi}}
\newcommand{\mbfomega}{\mathbf{\omega}}
\newcommand{\mbfvarepsilon}{\mathbf{\varepsilon}}
\newcommand{\mbfvartheta}{\mathbf{\vartheta}}
\newcommand{\mbfvarpi}{\mathbf{\varpi}}
\newcommand{\mbfvarrho}{\mathbf{\varrho}}
\newcommand{\mbfvarsigma}{\mathbf{\varsigma}}
\newcommand{\mbfvarphi}{\mathbf{\varphi}}

\newcommand{\mbfAlpha}{\mathbf{\Alpha}}
\newcommand{\mbfBeta}{\mathbf{\Beta}}
\newcommand{\mbfGamma}{\mathbf{\Gamma}}
\newcommand{\mbfDelta}{\mathbf{\Delta}}
\newcommand{\mbfEpsilon}{\mathbf{\Epsilon}}
\newcommand{\mbfZeta}{\mathbf{\Zeta}}
\newcommand{\mbfEta}{\mathbf{\Eta}}
\newcommand{\mbfTheta}{\mathbf{\Theta}}
\newcommand{\mbfIota}{\mathbf{\Iota}}
\newcommand{\mbfKappa}{\mathbf{\Kappa}}
\newcommand{\mbfLambda}{\mathbf{\Lambda}}
\newcommand{\mbfMu}{\mathbf{\Mu}}
\newcommand{\mbfNu}{\mathbf{\Nu}}
\newcommand{\mbfXi}{\mathbf{\Xi}}
\newcommand{\mbfPi}{\mathbf{\Pi}}
\newcommand{\mbfRho}{\mathbf{\Rho}}
\newcommand{\mbfSigma}{\mathbf{\Sigma}}
\newcommand{\mbfTau}{\mathbf{\Tau}}
\newcommand{\mbfUpsilon}{\mathbf{\Upsilon}}
\newcommand{\mbfPhi}{\mathbf{\Phi}}
\newcommand{\mbfChi}{\mathbf{\Chi}}
\newcommand{\mbfPsi}{\mathbf{\Psi}}
\newcommand{\mbfOmega}{\mathbf{\Omega}}
\newcommand{\mbfVarepsilon}{\mathbf{\Varepsilon}}
\newcommand{\mbfVartheta}{\mathbf{\Vartheta}}
\newcommand{\mbfVarpi}{\mathbf{\Varpi}}
\newcommand{\mbfVarrho}{\mathbf{\Varrho}}
\newcommand{\mbfVarsigma}{\mathbf{\Varsigma}}
\newcommand{\mbfVarphi}{\mathbf{\Varphi}}

% Caligraphic, Fraktur, Script

\newcommand{\mcalA}{\mathcal{A}}
\newcommand{\mcalB}{\mathcal{B}}
\newcommand{\mcalC}{\mathcal{C}}
\newcommand{\mcalD}{\mathcal{D}}
\newcommand{\mcalE}{\mathcal{E}}
\newcommand{\mcalF}{\mathcal{F}}
\newcommand{\mcalG}{\mathcal{G}}
\newcommand{\mcalH}{\mathcal{H}}
\newcommand{\mcalI}{\mathcal{I}}
\newcommand{\mcalJ}{\mathcal{J}}
\newcommand{\mcalK}{\mathcal{K}}
\newcommand{\mcalL}{\mathcal{L}}
\newcommand{\mcalM}{\mathcal{M}}
\newcommand{\mcalN}{\mathcal{N}}
\newcommand{\mcalO}{\mathcal{O}}
\newcommand{\mcalP}{\mathcal{P}}
\newcommand{\mcalQ}{\mathcal{Q}}
\newcommand{\mcalR}{\mathcal{R}}
\newcommand{\mcalS}{\mathcal{S}}
\newcommand{\mcalT}{\mathcal{T}}
\newcommand{\mcalU}{\mathcal{U}}
\newcommand{\mcalV}{\mathcal{V}}
\newcommand{\mcalW}{\mathcal{W}}
\newcommand{\mcalX}{\mathcal{X}}
\newcommand{\mcalY}{\mathcal{Y}}
\newcommand{\mcalZ}{\mathcal{Z}}

\newcommand{\mfrakA}{\mathfrak{A}}
\newcommand{\mfrakB}{\mathfrak{B}}
\newcommand{\mfrakC}{\mathfrak{C}}
\newcommand{\mfrakD}{\mathfrak{D}}
\newcommand{\mfrakE}{\mathfrak{E}}
\newcommand{\mfrakF}{\mathfrak{F}}
\newcommand{\mfrakG}{\mathfrak{G}}
\newcommand{\mfrakH}{\mathfrak{H}}
\newcommand{\mfrakI}{\mathfrak{I}}
\newcommand{\mfrakJ}{\mathfrak{J}}
\newcommand{\mfrakK}{\mathfrak{K}}
\newcommand{\mfrakL}{\mathfrak{L}}
\newcommand{\mfrakM}{\mathfrak{M}}
\newcommand{\mfrakN}{\mathfrak{N}}
\newcommand{\mfrakO}{\mathfrak{O}}
\newcommand{\mfrakP}{\mathfrak{P}}
\newcommand{\mfrakQ}{\mathfrak{Q}}
\newcommand{\mfrakR}{\mathfrak{R}}
\newcommand{\mfrakS}{\mathfrak{S}}
\newcommand{\mfrakT}{\mathfrak{T}}
\newcommand{\mfrakU}{\mathfrak{U}}
\newcommand{\mfrakV}{\mathfrak{V}}
\newcommand{\mfrakW}{\mathfrak{W}}
\newcommand{\mfrakX}{\mathfrak{X}}
\newcommand{\mfrakY}{\mathfrak{Y}}
\newcommand{\mfrakZ}{\mathfrak{Z}}

\newcommand{\mfraka}{\mathfrak{a}}
\newcommand{\mfrakb}{\mathfrak{b}}
\newcommand{\mfrakc}{\mathfrak{c}}
\newcommand{\mfrakd}{\mathfrak{d}}
\newcommand{\mfrake}{\mathfrak{e}}
\newcommand{\mfrakf}{\mathfrak{f}}
\newcommand{\mfrakg}{\mathfrak{g}}
\newcommand{\mfrakh}{\mathfrak{h}}
\newcommand{\mfraki}{\mathfrak{i}}
\newcommand{\mfrakj}{\mathfrak{j}}
\newcommand{\mfrakk}{\mathfrak{k}}
\newcommand{\mfrakl}{\mathfrak{l}}
\newcommand{\mfrakm}{\mathfrak{m}}
\newcommand{\mfrakn}{\mathfrak{n}}
\newcommand{\mfrako}{\mathfrak{o}}
\newcommand{\mfrakp}{\mathfrak{p}}
\newcommand{\mfrakq}{\mathfrak{q}}
\newcommand{\mfrakr}{\mathfrak{r}}
\newcommand{\mfraks}{\mathfrak{s}}
\newcommand{\mfrakt}{\mathfrak{t}}
\newcommand{\mfraku}{\mathfrak{u}}
\newcommand{\mfrakv}{\mathfrak{v}}
\newcommand{\mfrakw}{\mathfrak{w}}
\newcommand{\mfrakx}{\mathfrak{x}}
\newcommand{\mfraky}{\mathfrak{y}}
\newcommand{\mfrakz}{\mathfrak{z}}

\newcommand{\mscrA}{\mathscr{A}}
\newcommand{\mscrB}{\mathscr{B}}
\newcommand{\mscrC}{\mathscr{C}}
\newcommand{\mscrD}{\mathscr{D}}
\newcommand{\mscrE}{\mathscr{E}}
\newcommand{\mscrF}{\mathscr{F}}
\newcommand{\mscrG}{\mathscr{G}}
\newcommand{\mscrH}{\mathscr{H}}
\newcommand{\mscrI}{\mathscr{I}}
\newcommand{\mscrJ}{\mathscr{J}}
\newcommand{\mscrK}{\mathscr{K}}
\newcommand{\mscrL}{\mathscr{L}}
\newcommand{\mscrM}{\mathscr{M}}
\newcommand{\mscrN}{\mathscr{N}}
\newcommand{\mscrO}{\mathscr{O}}
\newcommand{\mscrP}{\mathscr{P}}
\newcommand{\mscrQ}{\mathscr{Q}}
\newcommand{\mscrR}{\mathscr{R}}
\newcommand{\mscrS}{\mathscr{S}}
\newcommand{\mscrT}{\mathscr{T}}
\newcommand{\mscrU}{\mathscr{U}}
\newcommand{\mscrV}{\mathscr{V}}
\newcommand{\mscrW}{\mathscr{W}}
\newcommand{\mscrX}{\mathscr{X}}
\newcommand{\mscrY}{\mathscr{Y}}
\newcommand{\mscrZ}{\mathscr{Z}}

\newcommand{\msfa}{ \mathsf{a} }
\newcommand{\msfb}{ \mathsf{b} }
\newcommand{\msfc}{ \mathsf{c} }
\newcommand{\msfd}{ \mathsf{d} }
\newcommand{\msfe}{ \mathsf{e} }
\newcommand{\msff}{ \mathsf{f} }
\newcommand{\msfg}{ \mathsf{g} }
\newcommand{\msfh}{ \mathsf{h} }
\newcommand{\msfi}{ \mathsf{i} }
\newcommand{\msfj}{ \mathsf{j} }
\newcommand{\msfk}{ \mathsf{k} }
\newcommand{\msfl}{ \mathsf{l} }
\newcommand{\msfm}{ \mathsf{m} }
\newcommand{\msfn}{ \mathsf{n} }
\newcommand{\msfo}{ \mathsf{o} }
\newcommand{\msfp}{ \mathsf{p} }
\newcommand{\msfq}{ \mathsf{q} }
\newcommand{\msfr}{ \mathsf{r} }
\newcommand{\msfs}{ \mathsf{s} }
\newcommand{\msft}{ \mathsf{t} }
\newcommand{\msfu}{ \mathsf{u} }
\newcommand{\msfv}{ \mathsf{v} }
\newcommand{\msfw}{ \mathsf{w} }
\newcommand{\msfx}{ \mathsf{x} }
\newcommand{\msfy}{ \mathsf{y} }
\newcommand{\msfz}{ \mathsf{z} }
\newcommand{\msfA}{ \mathsf{A} }
\newcommand{\msfB}{ \mathsf{B} }
\newcommand{\msfC}{ \mathsf{C} }
\newcommand{\msfD}{ \mathsf{D} }
\newcommand{\msfE}{ \mathsf{E} }
\newcommand{\msfF}{ \mathsf{F} }
\newcommand{\msfG}{ \mathsf{G} }
\newcommand{\msfH}{ \mathsf{H} }
\newcommand{\msfI}{ \mathsf{I} }
\newcommand{\msfJ}{ \mathsf{J} }
\newcommand{\msfK}{ \mathsf{K} }
\newcommand{\msfL}{ \mathsf{L} }
\newcommand{\msfM}{ \mathsf{M} }
\newcommand{\msfN}{ \mathsf{N} }
\newcommand{\msfO}{ \mathsf{O} }
\newcommand{\msfP}{ \mathsf{P} }
\newcommand{\msfQ}{ \mathsf{Q} }
\newcommand{\msfR}{ \mathsf{R} }
\newcommand{\msfS}{ \mathsf{S} }
\newcommand{\msfT}{ \mathsf{T} }
\newcommand{\msfU}{ \mathsf{U} }
\newcommand{\msfV}{ \mathsf{V} }
\newcommand{\msfW}{ \mathsf{W} }
\newcommand{\msfX}{ \mathsf{X} }
\newcommand{\msfY}{ \mathsf{Y} }
\newcommand{\msfZ}{ \mathsf{Z} }

%----------------------------------------------------------------------
\ifcsdef{chapter}{
    \numberwithin{equation}{chapter}
}{
    \numberwithin{equation}{section}
}

%----------------------------------------------------------------------
%% Modifiers
%----------------------------------------------------------------------

%----------------------------------------------------------------------
%% Operators
%----------------------------------------------------------------------
\DeclareMathOperator*{\argmax}{arg\,max}        % for argmax
\DeclareMathOperator*{\argmin}{arg\,min}        % for argmin
\newcommand{\const}{ \mathrm{Const} }
\newcommand{\Res}{\mathrm{Res\mathop{}}}    % for residue and
% resultant if no ambiguity
\newcommand{\Ind}{\mathrm{Ind\mathop{}}}    % for winding number
\newcommand{\NaN}{\texttt{NaN}}
\newcommand{\Card}{\mathrm{Card\mathop{}}}
\newcommand{\lcm}{\operatorname{lcm}}
\newcommand{\Div}{\operatorname{Div\mathop{}}}
\newcommand{\diver}{\operatorname{div\mathop{}}} % for divergence
\newcommand{\curl}{\operatorname{curl\mathop{}}} % for curl
\newcommand{\grad}{\operatorname{grad\mathop{}}} % for gradient%
\newcommand{\tr}{\operatorname{tr\mathop{}}} % for trace
\DeclareMathOperator{\proj}{\mathbf{pr}}        % for projection
\DeclareMathOperator{\prox}{\symrm{prox}}        % for proximal operator
\DeclareMathOperator*{\infconv}{%for infimal convolution
    \mathbin{\ooalign{\raisebox{-.35ex}{$\wedge$}\cr\hidewidth\raisebox{.5ex}{\scalebox{.9}{+}}\hidewidth}}
}

% Other
\newcommand{\diff}{\mathop{}\!\mathrm{d}} % for differential

% aligned inf and sup (use either of them)
% Raised subscript in \verb|\sup|
\newcommand{\supAdjusted}{\mathop{\smash{\mathrm{sup}}}}
% Lowered subscript in \verb|\inf|
\newcommand{\infAdjusted}{\mathop{\mathrm{inf}\vphantom{\mathrm{sup}}}}

%----------------------------------------------------------------------
%% Points and sets
%----------------------------------------------------------------------
\DeclareMathOperator{\dist}{dist}        % for distance
\newcommand{\sgn}{\operatorname{sgn}}        % for sign
\newcommand{\inj}{\hookrightarrow}        % for injections
\newcommand{\surj}{\twoheadrightarrow}        % for surjections
\newcommand{\bij}{\leftrightarrow}        % for bijections
\newcommand{\supp}{\mathrm{supp\mathop{}}} % for support of a function
\newcommand{\intr}{\mathrm{int\mathop{}}} % for interior
\newcommand{\cl}{\mathrm{cl\mathop{}}} % for closure
\newcommand{\ri}{\mathrm{ri\mathop{}}} % for relative interior
\newcommand{\qri}{\mathrm{qri\mathop{}}} % for quasi-relative interior
\newcommand{\core}{\mathrm{core\mathop{}}} % for algebraic core
\newcommand{\diam}{\mathrm{diam\mathop{}}} % for diameter
\renewcommand{\ker}{\mathrm{ker\mathop{}}} % for kernel of a function
\newcommand{\im}{\mathrm{im\mathop{}}} % for image of a function
\newcommand{\Spec}{\mathsf{Spec}}
\newcommand{\Fix}{\mathsf{Fix}} % for fixed points
\newcommand{\Lip}{\mathsf{Lip}} % for Lipschitz class
\newcommand{\TV}{\mathsf{TV}} % for total variation
%----------------------------------------------------------------------
%% Indices, Sequences and recursions
%----------------------------------------------------------------------

%----------------------------------------------------------------------
%% Matrices and vectors
%----------------------------------------------------------------------
\newcommand{\Mat}{\mathsf{Mat}} % for matrices
\newcommand{\diag}{\operatorname{diag}}
\newcommand{\SPD}{\mbbS_{++}}        % for Symmetric Positive Definite Matrices
\newcommand{\Rank}{\mathrm{Rank\mathop{}}}

%----------------------------------------------------------------------
%% Probability
%----------------------------------------------------------------------
\newcommand{\Law}{\mathsf{Law}} % for law of a random variable
\newcommand{\Prob}{\mathbb{P}}
\newcommand{\Var}{\operatorname{Var\mathop{}}} % for variance
\newcommand{\Cov}{\operatorname{Cov\mathop{}}} % for covariance
\newcommand{\iid}{\mathrm{i.i.d.}} % for independent and identically distributed
\newcommand{\simiid}{\overset{\mathrm{i.i.d.}}{\sim}}

\ExplSyntaxOn
\cs_new_protected:Nn \__independence_symbol:Nn
{
    \mathrel
    {
        \rlap{$#1#2$}
        \mkern2mu
        {#1#2}
    }
}

\NewDocumentCommand{\independent}{}
{
    \mkern-1.5mu
    \mathpalette\__independence_symbol:Nn{\perp}
    \mkern-1.5mu
}

\ExplSyntaxOff

%-------------------------------------------------------------------------------
% \expect command for mathematical expectation
%
% SYNTAX :
% \expect_{<subscript>}^{<superscript>}[<condition>]{<expression>}
%
% BEHAVIOR:
% - Creates the expectation symbol \mathbb{E}.
% - Subscripts (_) and superscripts (^) are  placed *before* the other
%   arguments and are attached to the \mathbb{E} symbol.
% - If the optional [<condition>] argument is provided, it typesets the
%   conditional expectation E[expression | condition].
% - If the optional argument is omitted, it typesets the standard
%   expectation E[expression].
%
% We use \operatorname{\mathbb{E}} to ensure that \mathbb{E} is treated
% as a mathematical operator. The `e{_^}` argument specifier from xparse
% is now at the beginning of the argument list to change the syntax order.
%-------------------------------------------------------------------------------
\NewDocumentCommand{\expect}{e{_^} O{} m}{
    \operatorname{\mathbb{E}}%
    \IfValueT{#1}{_{#1}}%
    \IfValueT{#2}{^{#2}}%
    \IfValueTF{#3}{
        \left[#4 \delimsize\vert #3\right]%
    }{
        \left[#4\right]%
    }
}

%==============Category Theory================
\newcommand{\op}{\mathrm{op}} % for opposite category
\newcommand{\catname}[1]{\mathsf{#1}} % for category
\newcommand{\Hom}{\catname{Hom}} % for homomorphism
\newcommand{\Iso}{\catname{Iso}} % for isomorphism
\newcommand{\Aut}{\catname{Aut}} % for automorphism
\newcommand{\End}{\catname{End}} % for endomorphism
\newcommand{\Mor}{\catname{Mor}} % for morphism
\newcommand{\Obj}{\catname{Obj}} % for object
\newcommand{\Set}{\catname{Set}} % for category of sets
\newcommand{\Grp}{\catname{Grp}} % for category of groups
\newcommand{\Ann}{\catname{Ann}} % for category of rings
\newcommand{\Mod}{\catname{Mod}} % for category of modules
\newcommand{\Vect}{\catname{Vect}} % for category of vector spaces
\newcommand{\Top}{\catname{Top}} % for category of topological spaces
\newcommand{\Ab}{\catname{Ab}} % for category of abelian groups
\newcommand{\Mon}{\catname{Mon}} % for category of monoids
\newcommand{\Pos}{\catname{Pos}} % for category of posets
\newcommand{\Pre}{\catname{Pre}} % for category of preorders
\newcommand{\Cat}{\catname{Cat}} % for category of categories
\newcommand{\Fun}{\catname{Fun}} % for category of functors
\newcommand{\Nat}{\catname{Nat}} % for category of natural transformations
\newcommand{\Id}{\mathrm{Id}} % for identity morphism
\newcommand{\id}{\mathrm{id}} % for identity morphism
\newcommand{\coker}{\mathrm{coker}} % for cokernel
\newcommand{\coim}{\mathrm{coim}} % for coimage
\newcommand{\codim}{\mathrm{codim}} % for codimension
\newcommand{\dom}{\mathrm{dom}} % for domain
\newcommand{\cod}{\mathrm{cod}} % for codomain

%==========Category Theory================EOF

%=======================================================================
% Alternative version with more precise dangerous bend curves
