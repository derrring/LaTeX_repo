\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{e_frontbackmatter_formal}[Formal Front Back Matter]

% 1. Load packages that are required for this front matter to work.
% These might already be in common style file, but \RequirePackage is safe.
\RequirePackage{xcolor}
\RequirePackage{hyperref} % For \pdfbookmark
\RequirePackage{etoolbox} % For safety with command definitions


% 2. Define commands for non-standard info (subtitle, location, etc.)
% We will use the standard \author, \title, \date for the main info.
\providecommand{\subtitle}[1]{\def\@subtitle{#1}}
\providecommand{\location}[1]{\def\@location{#1}}
\providecommand{\institution}[1]{\def\@institution{#1}}
\providecommand{\email}[1]{\def\@email{#1}}

% Set default values for new commands
\subtitle{ }
\location{ }
\email{ }
\institution{ }

% 3. Define commands for optional content (Acknowledgements/Abstract)
\providecommand{\setacknowledgements}[1]{\def\@myacknowledgements{#1}}
\providecommand{\setabstract}[1]{\def\@myabstract{#1}}
\providecommand{\setdedication}[1]{\def\@mydedication{#1}} 

\setacknowledgements{}
\setabstract{}
\setdedication{}



% 4. Define commands for each part of the front & back matter.
%    These are now modified to use the standard \@author, \@title, \@date

% == Main Title Page (from titlepage.tex) ==
\providecommand{\makefrontmatter}{%
    \begin{titlepage}
        \begin{center}
            \large
            % --- Institution (Optional) ---
            \ifstrempty{\@institution}{ }{%
                \begingroup
                    % Use a tabular environment to allow for line breaks in \@institution
                    \begin{tabular}{c}
                        \@institution
                    \end{tabular}
                \endgroup\par
                \vfill
            }
            % --- Title and Subtitle ---
            % This assumes \@title will always be provided.
            \begingroup
                {\@title}\par
            \endgroup
            % Subtitle is already optional.
            \ifstrempty{\@subtitle}{}{%
                \vspace{1em}\MakeUppercase{\footnotesize \@subtitle}
            }
            \vfill
            % --- Author and Email (Email is optional) ---
            % This assumes \@author will always be provided.
            \begingroup
                % The footnote for the email will only appear if \@email is set.
                {\normalsize \@author\ifstrempty{\@email}{}{\footnote{\@email}}} \par
            \endgroup
            \vfill\vfill
            % --- Location (Optional) ---
            \ifstrempty{\@location}{}{%
            \@location\par
            \vspace{0.5em}%
            }
            \@date% % \@date is usually set automatically
            \vfill
        \end{center}
    \end{titlepage}
}
% == Dedication  ==
\providecommand{\makededication}{%
    % Check if content has been provided for the dedication.
    \ifstrempty{\@mydedication}{}{%
        \clearpage\thispagestyle{empty}\vspace*{3cm}
        \@mydedication
        \cleardoublepage
    }%
}

% == Acknowledgements  ==
\providecommand{\makeacknowledgements}{%
    \ifstrempty{\@myacknowledgements}{}{%
        \chapter*{Acknowledgements}
        \@myacknowledgements 
        \cleardoublepage
    }%
}

% == Abstract  ==
\providecommand{\makeabstract}{%
    \ifstrempty{\@myabstract}{}{%
        \chapter*{Abstract}
        \@myabstract
        \cleardoublepage
    }%
}


\providecommand{\makebackmatter}{%
    \thispagestyle{empty}
    \vfill
    \noindent\@author: \textit{\@title,} \textcopyright\ \@date
    \cleardoublepage
}